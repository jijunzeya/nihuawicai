{"version":3,"sources":["../../src/handler/SocketHandler.js"],"names":["SocketHandler","server","rooms","chatHandlers","io","nsp","of","on","console","log","socket","id","chatHandler","roomId","_user","nickName","func"],"mappings":";;;;;;;;AAGA;AACA;;;AAHA;;;;AAIA;;;;;;;;IACqBA,a;AAInB,yBAAYC,MAAZ,EAAoB;AAAA;;AAAA;;AAAA,SAHpBC,KAGoB,GAHZ,EAGY;AAAA,SAFpBC,YAEoB,GAFL,EAEK;;AAClB,QAAIC,KAAK,qBAAaH,MAAb,CAAT;AACA,QAAII,MAAMD,GAAGE,EAAH,CAAM,OAAN,CAAV;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACAD,QAAIE,EAAJ,CAAO,YAAP,EAAqB,kBAAU;AAC7BC,cAAQC,GAAR,CAAY,yBAAyBC,OAAOC,EAA5C;AACA,UAAIC,cAAc,0BAAgBP,GAAhB,EAAqB,MAAKH,KAA1B,EAAiCQ,MAAjC,EAAyC,UAACG,MAAD,EAAY;AACrE;AACAL,gBAAQC,GAAR,CAAY,gBAAgBI,MAA5B;AACD,OAHiB,EAGf,UAACA,MAAD,EAAY;AACb;AACAL,gBAAQC,GAAR,CAAY,gBAAgBI,MAA5B;AACD,OANiB,CAAlB;AAOA,YAAKV,YAAL,CAAkBO,OAAOC,EAAzB,IAA+BC,WAA/B;AACAJ,cAAQC,GAAR,CAAY,oBAAoBG,YAAYE,KAAZ,CAAkBC,QAAlD;AACA;AACAL,aAAOH,EAAP,CAAU,YAAV,EAAwB,YAAM;AAC5BC,gBAAQC,GAAR,CAAY,2BAA2BC,OAAOC,EAA9C;AACA,eAAO,MAAKR,YAAL,CAAkBO,OAAOC,EAAzB,CAAP;AACA;AACD,OAJD;AAMD,KAlBD;AAoBD;;;;yBAEKK,I,EAAM,CAEX;;;;;;kBA5CkBhB,a","file":"SocketHandler.js","sourcesContent":["\nimport SocketIO from 'socket.io';\n\n// import User from './beans/User';\n// import Room from './beans/Room';\nimport ChatHandler from './ChatHandler';\nexport default class SocketHandler {\n  rooms = {};\n  chatHandlers = {};\n\n  constructor(server) {\n    let io = new SocketIO(server);\n    let nsp = io.of('/chat');\n\n    // middleware\n    // nsp.use((socket, next) => {\n    //   let token = socket.handshake.query.token;\n    //   console.log('@@##nsp middleware:' + token);\n    //   return next();\n    //   // if (isValid(token)) {\n    //   //   return next();\n    //   // }\n    //   // return next(new Error('authentication error'));\n    // });\n\n    // let nsp =io;\n    nsp.on('connection', socket => {\n      console.log('@@##nsp connection :' + socket.id);\n      let chatHandler = new ChatHandler(nsp, this.rooms, socket, (roomId) => {\n        //创建room成功\n        console.log('@@##创建房间成功:' + roomId);\n      }, (roomId) => {\n        // 加入room成功\n        console.log('@@##加入房间成功:' + roomId);\n      });\n      this.chatHandlers[socket.id] = chatHandler;\n      console.log('@@##connection:' + chatHandler._user.nickName);\n      // console.log('@@##connection:' + this.chatHandlers.keys());\n      socket.on('disconnect', () => {\n        console.log('@@##socket disconnect:' + socket.id);\n        delete this.chatHandlers[socket.id];\n        // console.log('@@##disconnect:' + JSON.stringify(this.chatHandlers));\n      })\n\n    });\n\n  }\n\n  init (func) {\n\n  }\n\n}"]}